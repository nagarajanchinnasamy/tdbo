
<html><head>
<title>tdbo - Tcl DataBase Objects</title>
<style type="text/css"><!--
    HTML {
	background: 	#FFFFFF;
	color: 		black;
    }
    BODY {
	background: 	#FFFFFF;
	color:	 	black;
    }
    DIV.doctools {
	margin-left:	10%;
	margin-right:	10%;
    }
    DIV.doctools H1,DIV.doctools H2 {
	margin-left:	-5%;
    }
    H1, H2, H3, H4 {
	margin-top: 	1em;
	font-family:	sans-serif;
	font-size:	large;
	color:		#005A9C;
	background: 	transparent;
	text-align:		left;
    }
    H1.title {
	text-align: center;
    }
    UL,OL {
	margin-right: 0em;
	margin-top: 3pt;
	margin-bottom: 3pt;
    }
    UL LI {
	list-style: disc;
    }
    OL LI {
	list-style: decimal;
    }
    DT {
	padding-top: 	1ex;
    }
    UL.toc,UL.toc UL, UL.toc UL UL {
	font:		normal 12pt/14pt sans-serif;
	list-style:	none;
    }
    LI.section, LI.subsection {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding: 	0em;
    }
    PRE {
	display: 	block;
	font-family:	monospace;
	white-space:	pre;
	margin:		0%;
	padding-top:	0.5ex;
	padding-bottom:	0.5ex;
	padding-left:	1ex;
	padding-right:	1ex;
	width:		100%;
    }
    PRE.example {
	color: 		black;
	background: 	#f5dcb3;
	border:		1px solid black;
    }
    UL.requirements LI, UL.syntax LI {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding:	0em;
    }
    DIV.synopsis {
	color: 		black;
	background: 	#80ffff;
	border:		1px solid black;
	font-family:	serif;
	margin-top: 	1em;
	margin-bottom: 	1em;
    }
    UL.syntax {
	margin-top: 	1em;
	border-top:	1px solid black;
    }
    UL.requirements {
	margin-bottom: 	1em;
	border-bottom:	1px solid black;
    }
--></style>
</head>
<! -- Generated from file 'tdbo.man' by tcllib/doctools with format 'html'
   -->
<! -- Copyright &copy; 2013, Nagarajan Chinnasamy &lt;nagarajanchinnasamy@gmail.com&gt;
   -->
<! -- CVS: $Id$ tdbo.n
   -->
<body><div class="doctools">
<h1 class="title">tdbo(n) 0.1.4 tdbo &quot;Tcl DataBase Objects&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>tdbo - Framework that provides Object Oriented Access to a Data Store</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">Commands</a>
<ul>
<li class="subsection"><a href="#subsection1">TDBO Commands</a></li>
<li class="subsection"><a href="#subsection2">TDBO Driver Commands</a></li>
<li class="subsection"><a href="#subsection3">TDBO Object Commands</a></li>
<li class="subsection"><a href="#subsection4">TDBO Connection Commands</a></li>
</ul>
</li>
<li class="section"><a href="#section3">TDBO Itcl Interface</a>
<ul>
<li class="subsection"><a href="#subsection5">Constructor &amp; Destructor</a></li>
<li class="subsection"><a href="#subsection6">Proc / Methods</a></li>
<li class="subsection"><a href="#subsection7">Common / Variables</a></li>
</ul>
</li>
<li class="section"><a href="#section4">TDBO Tcllib-Record Like Interface</a>
<ul>
<li class="subsection"><a href="#subsection8">Record Commands</a></li>
<li class="subsection"><a href="#subsection9">Definition Commands</a></li>
<li class="subsection"><a href="#subsection10">Record Instance Commands</a></li>
</ul>
</li>
<li class="section"><a href="#section5">Object To Record Mapping</a></li>
<li class="section"><a href="#section6">EXAMPLES</a></li>
<li class="section"><a href="#section7">See Also</a></li>
<li class="section"><a href="#section8">AUTHOR</a></li>
<li class="section"><a href="#section9">BUGS, IDEAS, FEEDBACK</a></li>
<li class="section"><a href="#keywords">Keywords</a></li>
<li class="section"><a href="#category">Category</a></li>
<li class="section"><a href="#copyright">Copyright</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="requirements">
<li>package require <b class="pkgname">tdbo</b></li>
</ul>
<ul class="syntax">
<li><a href="#1"><b class="cmd">tdbo load</b> <i class="arg">driver</i></a></li>
<li><a href="#2"><i class="arg">db</i> <b class="cmd">open</b> <i class="arg">args</i></a></li>
<li><a href="#3"><i class="arg">obj</i> <b class="cmd">configure</b> <span class="opt">?<i class="arg">args</i>?</span></a></li>
<li><a href="#4"><i class="arg">obj</i> <b class="cmd">cget</b> <span class="opt">?<i class="arg">args</i>?</span></a></li>
<li><a href="#5"><i class="arg">obj</i> <b class="cmd">clear</b></a></li>
<li><a href="#6"><i class="arg">obj</i> <b class="cmd">add</b> <span class="opt">?<i class="arg">args</i>?</span></a></li>
<li><a href="#7"><i class="arg">obj</i> <b class="cmd">delete</b></a></li>
<li><a href="#8"><i class="arg">obj</i> <b class="cmd">get</b> <span class="opt">?<i class="arg">args</i>?</span></a></li>
<li><a href="#9"><i class="arg">obj</i> <b class="cmd">save</b> <span class="opt">?<i class="arg">args</i>?</span></a></li>
<li><a href="#10"><i class="arg">conn</i> <b class="cmd">begin</b> <span class="opt">?<i class="arg">args</i>?</span></a></li>
<li><a href="#11"><i class="arg">conn</i> <b class="cmd">close</b></a></li>
<li><a href="#12"><i class="arg">conn</i> <b class="cmd">commit</b></a></li>
<li><a href="#13"><i class="arg">conn</i> <b class="cmd">conn</b></a></li>
<li><a href="#14"><i class="arg">conn</i> <b class="cmd">rollback</b></a></li>
<li><a href="#15"><i class="arg">class</i> <b class="cmd">tdbo::Itcl::DBObject</b></a></li>
<li><a href="#16"><i class="arg">class</i> <b class="cmd">tdbo::record::reocrd</b></a></li>
<li><a href="#17"><b class="cmd">record delete instance</b> <i class="arg">instanceName</i></a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>The <b class="cmd">tdbo</b> package provides an object oriented mechanism to access
data in data stores. A tdbo object instance provides <b class="cmd">add</b>,
<b class="cmd">get</b>, <b class="cmd">save</b> and <b class="cmd">delete</b> methods to manipulate data in
the data store. In addition, they provide <b class="cmd">configure</b> and <b class="cmd">cget</b>
methods to access data members of an instance in a standard tcl-ish
style.</p>
<p>tdbo objects can be defined in various ways:</p>
<ol class="enumerated">
<li><p>Through <b class="cmd">tdbo::record</b> package, TDBO provides a way for
applications to define and use tdbo objects with Tcllib's
<b class="cmd">struct::record</b> like structure.</p></li>
<li><p>by inheriting Itcl based <b class="class">tdbo::Itcl::DBObject</b> class.</p></li>
<li><p>Others to follow ....</p></li>
</ol>
<p>A data-store-driver is the one that implements necessary connectivity
mechanism and procedures to access the data store. <b class="cmd">tdbo::load</b>
method is used to load a specific data-store-driver instance. Using
<b class="cmd">open</b> method of a data-store-driver instance, an application
obtains one or many connection handles to the data store. During the
instantiation of a tdbo object, a connection handle is passed on to it
to make use of the connection handle to perform <b class="cmd">add</b>, <b class="cmd">get</b>,
<b class="cmd">save</b> and <b class="cmd">delete</b> methods on the data store.</p>
<p>Using the connection handle, an application can also invoke 1)
<b class="cmd">mget</b> 2) <b class="cmd">begin</b>, <b class="cmd">commit</b> and <b class="cmd">rollback</b> and 3)
<b class="cmd">close</b> methods to 1) retrieve multiple data records based on
filtering, sorting and grouping criteria 2) perform atomic and
concurrent transactions and 3) close the connection respectively.</p>
<p>Currently, tdbo supports <b class="const">sqlite3</b>, <b class="const">mysqltcl</b>,
<b class="const">Pgtcl</b>, <b class="const">tdbc::sqlite3</b>, <b class="const">tdbc::mysql</b> and
<b class="const">tdbc::postgres</b> drivers. Note that sqlite3, mysqltcl and
Pgtcl drivers are functional in Tcl 8.5 and later releases while
tdbc::&lt;driver&gt;s are available only from Tcl 8.6 onwards.</p>
</div>
<div id="section2" class="section"><h2><a name="section2">Commands</a></h2>
<div id="subsection1" class="subsection"><h3><a name="subsection1">TDBO Commands</a></h3>
<dl class="definitions">
<dt><a name="1"><b class="cmd">tdbo load</b> <i class="arg">driver</i></a></dt>
<dd><p>Loads a data-store-driver and returns a handle to the driver instance.
<i class="arg">driver</i> is one of the supported drivers listed in the Description
section.</p></dd>
</dl>
</div>
<div id="subsection2" class="subsection"><h3><a name="subsection2">TDBO Driver Commands</a></h3>
<dl class="definitions">
<dt><a name="2"><i class="arg">db</i> <b class="cmd">open</b> <i class="arg">args</i></a></dt>
<dd><p>Where <i class="arg">db</i> is the data-store-driver instance handle returned by
<b class="cmd">tdbo load</b> command. This command establishes a new connection to
the database and returns the connection handle. Arguments are driver
dependent. Please refer to the documentation of respective driver.</p></dd>
</dl>
</div>
<div id="subsection3" class="subsection"><h3><a name="subsection3">TDBO Object Commands</a></h3>
<p>A tdbo object can be defined using various ways based on the OO system
the application written in. Please refer to the corresponding section
on how to define and use tdbo objects using the respective OO system.</p>
<dl class="definitions">
<dt><a name="3"><i class="arg">obj</i> <b class="cmd">configure</b> <span class="opt">?<i class="arg">args</i>?</span></a></dt>
<dd><p>Method to configure (set) the member variables of an object. Arguments
are OO system dependent. Please refer to the correponding section on
how to define and use tdbo objects using the respective OO system.</p></dd>
<dt><a name="4"><i class="arg">obj</i> <b class="cmd">cget</b> <span class="opt">?<i class="arg">args</i>?</span></a></dt>
<dd><p>Method to retrieve the values of member variables of an object. Arguments
are OO system dependent. Please refer to the correponding section on
how to define and use tdbo objects using the respective OO system.</p></dd>
<dt><a name="5"><i class="arg">obj</i> <b class="cmd">clear</b></a></dt>
<dd><p>Method to reset the values of member variables of an object. Behaviour
is OO system dependent. Please refer to the correponding section on
how to define and use tdbo objects using the respective OO system.</p></dd>
<dt><a name="6"><i class="arg">obj</i> <b class="cmd">add</b> <span class="opt">?<i class="arg">args</i>?</span></a></dt>
<dd><p>Insert the object as a new record into database. In preparing the record to insert, this method prepares a list of name-value pairs, by default, from all public member variables of the object. However, if the argument <i class="arg">args</i> is passed, it uses only those field names in <i class="arg">args</i> to prepare the name-value pairs. While preparing the name-value pairs, it skips those member variables that are not defined (un-initialized). To set a particular field's value to NULL, you need to set the value of the corresponding public member variable to &quot;&lt;null&gt;&quot;. Upon successful completion of add operation, the new values of sequence / auto-incremented fields are populated back into the object.</p></dd>
<dt><a name="7"><i class="arg">obj</i> <b class="cmd">delete</b></a></dt>
<dd><p>Delete the record represented by the object from database and reset the object values. The record to be deleted from the database is identified based on the description given in the section <span class="sectref"><a href="#section5">Object To Record Mapping</a></span>.</p></dd>
<dt><a name="8"><i class="arg">obj</i> <b class="cmd">get</b> <span class="opt">?<i class="arg">args</i>?</span></a></dt>
<dd><p>Retrieve a record from the database and populate object's member variables with values retrieved. The record to be retrieved from the database is identified based on the description given in the section <span class="sectref"><a href="#section5">Object To Record Mapping</a></span>. By default, this method uses all public member variable names as the fields of the record to be retrieved from the database. However, if the argument <i class="arg">args</i> is passed with a list of field names (corresponding to its public member variables), then only those fields are retrieved and populated into the object.</p></dd>
<dt><a name="9"><i class="arg">obj</i> <b class="cmd">save</b> <span class="opt">?<i class="arg">args</i>?</span></a></dt>
<dd><p>Save the object by updating the corresponding record in the database. The record to be updated in the database is identified based on the description given in the section <span class="sectref"><a href="#section5">Object To Record Mapping</a></span>. In preparing the record to save, this method prepares a list of name-value pairs, by default, from all public member variables of the object. However, if the argument <i class="arg">args</i> is passed, it uses only those field names in <i class="arg">args</i> to  prepare the name-value pairs. While preparing the name-value pairs, it skips those member variables that are not defined (un-initialized). To set a particular field's value to NULL, you need to set the value of the corresponding public member variable to &quot;&lt;null&gt;&quot;.</p></dd>
</dl>
</div>
<div id="subsection4" class="subsection"><h3><a name="subsection4">TDBO Connection Commands</a></h3>
<dl class="definitions">
<dt><a name="10"><i class="arg">conn</i> <b class="cmd">begin</b> <span class="opt">?<i class="arg">args</i>?</span></a></dt>
<dd><p>Begins a database transaction. Arguments are driver dependent. Please
refer to the documentation of respective driver.</p></dd>
<dt><a name="11"><i class="arg">conn</i> <b class="cmd">close</b></a></dt>
<dd><p>Closes the connection with database.</p></dd>
<dt><a name="12"><i class="arg">conn</i> <b class="cmd">commit</b></a></dt>
<dd><p>Commits the currently active database transaction.</p></dd>
<dt><a name="13"><i class="arg">conn</i> <b class="cmd">conn</b></a></dt>
<dd><p>The connection handle obtained through <i class="arg">db</i> <b class="cmd">open</b> method is
actually a surrogate handle creted by tdbo package. Invoke this command
to get hold of the real connection handle as returned by the
data-store-driver. Use this connection handle with care so that it does
not interfere with the functioning of tdbo commands.</p></dd>
<dt><a name="14"><i class="arg">conn</i> <b class="cmd">rollback</b></a></dt>
<dd><p>Rolls back the currently active database transaction.</p></dd>
</dl>
</div>
</div>
<div id="section3" class="section"><h2><a name="section3">TDBO Itcl Interface</a></h2>
<p>Through <b class="cmd">tdbo::Itcl</b> package, TDBO provides a way for Itcl based
applications to define and use Itcl based tdbo objects. To make use of
this feature you will need to <b class="cmd">package require</b> <b class="const">tdbo::Itcl</b>.</p>
<dl class="definitions">
<dt><a name="15"><i class="arg">class</i> <b class="cmd">tdbo::Itcl::DBObject</b></a></dt>
<dd><p>A base class to be inherited by Itcl based tdbo object definitions.</p></dd>
</dl>
<div id="subsection5" class="subsection"><h3><a name="subsection5">Constructor &amp; Destructor</a></h3>
<dl class="definitions">
<dt><b class="cmd">tdbo::Itcl::DBObject::constructor</b> <i class="arg">conn</i></dt>
<dd><p>Stores the definition of primary keys, unique fields and sequence / auto-increment fields by invoking following protected methods: <b class="method">_define_primarykey</b>, <b class="method">_define_unique</b> and <b class="method">_define_autoincrement</b>. Also prepares list of field names for later usage by <b class="method">add</b> and <b class="method">save</b> methods. <i class="arg">conn</i> is the connection handle obtained through <i class="arg">db</i> <b class="cmd">open</b> command.</p></dd>
<dt><b class="cmd">tdbo::Itcl::DBObject::destructor</b></dt>
<dd><p>Nothing special done here.</p></dd>
</dl>
</div>
<div id="subsection6" class="subsection"><h3><a name="subsection6">Proc / Methods</a></h3>
<dl class="definitions">
<dt><i class="arg">public proc</i> <b class="cmd">tdbo::Itcl::DBObject::schema_name</b></dt>
<dd><p>This is an abstract static proc to be implemented by the derived class
to return the name of the table / view that the derived class
represents.</p></dd>
<dt><i class="arg">protected method</i> <b class="cmd">tdbo::Itcl::DBObject::_define_primarykey</b></dt>
<dd><p>Provides a default implementation by invoking <b class="method">define_primarykey</b>
with an empty list. Override this method to invoke
<b class="cmd">define_primarykey</b> with your own list of names of the public
variables that constitute the primary key of the table that the class
represents.</p></dd>
<dt><i class="arg">protected method</i> <b class="cmd">tdbo::Itcl::DBObject::_define_unique</b></dt>
<dd><p>Provides a default implementation by invoking <b class="method">define_unique</b>
with an empty list. Override this method to invoke
<b class="cmd">define_unique</b> with your own list of list-of-names of the public
variables that constitute the unique fields of the table or view that
the class represents.</p></dd>
<dt><i class="arg">protected method</i> <b class="cmd">tdbo::Itcl::DBObject::_define_autoincrement</b></dt>
<dd><p>Provides a default implementation by invoking
<b class="method">define_autoincrement</b> with an empty list. Override this method
to invoke <b class="cmd">define_autoincrement</b> with your own list of names of the
public variables that are autoincrement or sequence fields in the table
that the class represents.</p></dd>
<dt><i class="arg">protected method</i> <b class="cmd">tdbo::Itcl::DBObject::define_primarykey</b> <i class="arg">args</i></dt>
<dd><p>Defines a list of public variable names that map to the primary key
fields of the associated table / view in the database. This method is
meant to be invoked by derived classes from within
<b class="method">_define_primarykey</b> method. <i class="arg">args</i> is a list of field names
that constitute the primary key.</p></dd>
<dt><i class="arg">protected method</i> <b class="cmd">tdbo::Itcl::DBObject::define_unique</b> <i class="arg">args</i></dt>
<dd><p>Defines a list of list of public variable names that map to the list of
combination of unique fields of the associated table / view in the
database. This method is meant to be invoked by derived classes
from within <b class="method">_define_unique</b> method. <i class="arg">args</i> is a list of
list-of-field-names that constitute list of combination of unique
fields.</p></dd>
<dt><i class="arg">protected method</i> <b class="cmd">tdbo::Itcl::DBObject::define_autoincrement</b> <i class="arg">args</i></dt>
<dd><p>Defines a list of public variable names that map to the auto-increment / 
sequence fields of the associated table / view in the database. This
method is meant to be invoked by derived classes from within
<b class="method">_define_autoincrement</b> method. <i class="arg">args</i> is a list of field
names that are auto-increment / sequence fields.</p></dd>
<dt><i class="arg">public method</i> <b class="cmd">tdbo::Itcl::DBObject::configure</b> <i class="arg">{option &quot;&quot;}</i> <i class="arg">args</i></dt>
<dd><p>This method has following usages:</p>
<dl class="definitions">
<dt><i class="arg">obj</i> <b class="cmd">configure</b> <span class="opt">?<i class="arg">-opt1 val</i>?</span> <span class="opt">?<i class="arg">-opt2 val</i>?</span> <span class="opt">?<i class="arg">...</i>?</span></dt>
<dd><p>To set values of public member variables. <i class="arg">opt</i> is the name of a public member variable.</p></dd>
<dt><i class="arg">obj</i> <b class="cmd">configure</b> <i class="arg">from_obj</i></dt>
<dd><p>Object to object copy. To copy the values of all public member variables of <i class="arg">from_obj</i> into the corresponding public member variables of <i class="arg">obj</i>.</p></dd>
<dt><i class="arg">obj</i> <b class="cmd">configure</b></dt>
<dd><p>To retrieve initial and current values of all public member variables. Returns a dictionary in the format: -opt {-ival val -cval val} -opt {-ival val -cval val} ...</p></dd>
<dt><b class="cmd">class</b> <i class="arg">obj</i> <i class="arg">-opt1 val</i> <span class="opt">?<i class="arg">-opt2 val</i>?</span> <span class="opt">?<i class="arg">...</i>?</span></dt>
<dd><p>Though this is not a direct usage of this method, when <i class="arg">obj</i> is being constructed, Itcl's object construction mechanism invokes the 1st usage of the <b class="method">configure</b> method on <i class="arg">obj</i> passing <i class="arg">-opt1 val</i> <span class="opt">?<i class="arg">-opt2 val</i>?</span> <span class="opt">?<i class="arg">...</i>?</span> as its arguments to set the values of the public member variables.</p></dd>
<dt><b class="cmd">class</b> <i class="arg">obj</i> <i class="arg">from_obj</i></dt>
<dd><p>Though this is not a direct usage of this method, when <i class="arg">obj</i> is being constructed, ITcl's object construction mechanism invokes the 2nd usage of the <b class="method">configure</b> method on <i class="arg">obj</i> passing <i class="arg">from_obj</i> as its parameter. Hence, it results into object-to-object copy of public member variables.</p></dd>
</dl></dd>
<dt><i class="arg">public method</i> <b class="cmd">tdbo::Itcl::DBObject::cget</b> <i class="arg">{option &quot;&quot;}</i> <i class="arg">args</i></dt>
<dd><p>This method has following usages:</p>
<dl class="definitions">
<dt><i class="arg">obj</i> <b class="cmd">cget</b> <i class="arg">-opt</i></dt>
<dd><p>Returns current value of the public member variable specified by <i class="arg">opt</i>.</p></dd>
<dt><i class="arg">obj</i> <b class="cmd">cget</b> <i class="arg">-opt1 vName1</i> <span class="opt">?<i class="arg">-opt2 vName2</i>?</span> <span class="opt">?<i class="arg">...</i>?</span></dt>
<dd><p>To get the value of public member variables into the respective variable names specified. <i class="arg">opt</i> is the name of a public member variable. <i class="arg">vName</i> is the name of a variable into which the value of the <i class="arg">opt</i> is to be stored.</p></dd>
<dt><i class="arg">obj</i> <b class="cmd">cget</b></dt>
<dd><p>To get current values of all public member variables as a dictionary. Returns the dictionary in the format: -opt1 val1 -opt2 val2 ...</p></dd>
</dl></dd>
<dt><i class="arg">public method</i> <b class="cmd">tdbo::Itcl::DBObject::clear</b></dt>
<dd><p>Resets all public member variables with the initialization value given in the class definition.</p></dd>
<dt><i class="arg">public method</i> <b class="cmd">tdbo::Itcl::DBObject::add</b> <span class="opt">?<i class="arg">args</i>?</span></dt>
<dd><p>Insert the object as a new record into database. In preparing the record to insert, this method prepares a list of name-value pairs, by default, from all public member variables of the object. However, if the argument <i class="arg">args</i> is passed, it uses only those field names in the <i class="arg">args</i> to prepare the name-value pairs. While preparing the name-value pairs, it includes only those member variables that are initialized with a value other than &quot;&lt;undefined&gt;&quot;. In Itcl, Member variables that are uninitialized or unset are internally identified with the value &quot;&lt;undefined&gt;&quot;. We make use of this state of a member variable to omit a field in the insert operation. To set a particular field's value to NULL, you need to set the value of the corresponding public member variable to &quot;&lt;null&gt;&quot;. Upon successful completion of add operation, the new values of sequence / auto-incremented fields are populated back into the object.</p></dd>
<dt><i class="arg">public method</i> <b class="cmd">tdbo::Itcl::DBObject::delete</b></dt>
<dd><p>Delete the record represented by the object from database and reset the object values. The record to be deleted from the database is identified based on the description given in the section <span class="sectref"><a href="#section5">Object To Record Mapping</a></span>.</p></dd>
<dt><i class="arg">public method</i> <b class="cmd">tdbo::Itcl::DBObject::get</b> <span class="opt">?<i class="arg">args</i>?</span></dt>
<dd><p>Retrieve a record from the database and populate object's member variables with values retrieved. The record to be retrieved from the database is identified based on the description given in the section <span class="sectref"><a href="#section5">Object To Record Mapping</a></span>. By default, this method uses all public member variable names as the fields of the record to be retrieved from the database. However, if the argument <i class="arg">args</i> is passed with a list of field names (corresponding to its public member variables), then only those fields are retrieved and populated into the object.</p></dd>
<dt><i class="arg">public method</i> <b class="cmd">tdbo::Itcl::DBObject::save</b> <span class="opt">?<i class="arg">args</i>?</span></dt>
<dd><p>Save the object by updating the corresponding record in the database. The record to be updated in the database is identified based on the description given in the section <span class="sectref"><a href="#section5">Object To Record Mapping</a></span>. In preparing the record to save, this method prepares a list of name-value pairs, by default, from all public member variables of the object. However, if the argument <i class="arg">args</i> is passed, it uses only those field names in <i class="arg">args</i> to prepare the name-value pairs. While preparing the name-value pairs, it includes only those member variables that are initialized with a value other than &lt;undefined&gt;. In Itcl, member variables that are not initialized or unset are internally identified with the value &lt;undefined&gt;. We make use of this state of a member variable to omit a field in the update operation. To set a particular field's value to NULL, you need to set the value of the corresponding public member variable to &quot;&lt;null&gt;&quot;.</p></dd>
</dl>
</div>
<div id="subsection7" class="subsection"><h3><a name="subsection7">Common / Variables</a></h3>
<dl class="definitions">
<dt><i class="arg">protected variable</i> <b class="cmd">tdbo::Itcl::DBObject::clsName</b></dt>
<dd><p>Name of the derived class as returned by [$this info class]</p></dd>
<dt><i class="arg">protected variable</i> <b class="cmd">tdbo::Itcl::DBObject::log</b></dt>
<dd><p>Tcllib's logger object command to invoke logging commands such as ${log}::info &quot;message&quot;</p></dd>
</dl>
</div>
</div>
<div id="section4" class="section"><h2><a name="section4">TDBO Tcllib-Record Like Interface</a></h2>
<p>Through <b class="cmd">tdbo::record</b> package, TDBO provides a way for non-OO based
applications to define and use tdbo objects with a <b class="cmd">struct::record</b>
like structure. To make use of this feature you will need to
<b class="cmd">package require</b> <b class="const">tdbo::record</b>.</p>
<dl class="definitions">
<dt><a name="16"><i class="arg">class</i> <b class="cmd">tdbo::record::reocrd</b></a></dt>
<dd><p>The <b class="cmd">tdbo::record</b> package only contains one top level command, but
several sub commands (see below). It also obeys the namespace in which
the tdbo object was defined, hence the objects returned are fully
qualified.</p></dd>
</dl>
<div id="subsection8" class="subsection"><h3><a name="subsection8">Record Commands</a></h3>
<dl class="definitions">
<dt><b class="cmd">record define</b> <i class="arg">definitionName</i> <i class="arg">schemaName</i> <i class="arg">schemaFields</i> <span class="opt">?<i class="arg">-primarykey  fieldsList</i>?</span> <span class="opt">?<i class="arg">-autoincrement fieldsList</i>?</span> <span class="opt">?<i class="arg">-unique fieldsListOfLists</i>?</span></dt>
<dd><p>Defines a tdbo object with the definition <i class="arg">definitionName</i> that is
also used as an object command. This object command is used to
create tdbo object instances. <i class="arg">schemaName</i> is the name of the
table/view that this definition represents. <i class="arg">schemaFields</i> are the
field names of the table / view. Optional arguments
<span class="opt">?<i class="arg">-primarykey  fieldsList</i>?</span> 
<span class="opt">?<i class="arg">-autoincrement fieldsList</i>?</span>
<span class="opt">?<i class="arg">-unique fieldsListOfLists</i>?</span> are used to include further
details of the tdbo object definition.</p>
<p>A record definition contains a list of field names, where each field name
represents a column name in a table/view. A field can optionally have a
default initial value. When a default value is given, the field is
specified as a list having its name and value as list elements. If no
default initial value is given, then the value is automatically set to
<b class="const">&lt;undefined&gt;</b> by the <b class="method">record define</b> method. For
example, a definition of address table would look like this:</p>
<pre class="example">
dao define Address address {
	id
    addrline1
    addrline2
    {city Bangalore}
    {postalcode 560001}
    {country India}
}
</pre>
<p>All instances created from this definition, will initially have 
Bangalore, 560001 and India as the value for <i class="arg">city</i>,
<i class="arg">postalcode</i> and <i class="arg">country</i> respectively. <i class="arg">addrline1</i> and
<i class="arg">addrline2</i> will have internally set value of
<b class="const">&lt;undefined&gt;</b></p></dd>
<dt><b class="cmd">record delete</b> <i class="arg">definition</i> <i class="arg">definitionName</i></dt>
<dd><p>Deletes tdbo object definition <i class="arg">definitionName</i>, and all instances
of <i class="arg">definitionName</i>. It returns an error if the <i class="arg">definitionName</i>
does not exist.</p></dd>
<dt><a name="17"><b class="cmd">record delete instance</b> <i class="arg">instanceName</i></a></dt>
<dd><p>Deletes <i class="arg">instance</i> with the name of <i class="arg">instanceName</i>. It
returns an error if the <i class="arg">instanceName</i> does not exist.</p></dd>
</dl>
</div>
<div id="subsection9" class="subsection"><h3><a name="subsection9">Definition Commands</a></h3>
<p>tdbo object instances are created using the <i class="arg">definitionName</i>
command that was returned by <b class="method">record define</b> command.</p>
<dl class="definitions">
<dt><i class="arg">definitionName</i> <b class="method"><i class="arg">instanceName|#auto</i></b> <b class="method"><i class="arg">conn</i></b> <span class="opt">?<i class="arg">-field1 val1</i>?</span> <span class="opt">?<i class="arg">-field2 val2</i>?</span> <span class="opt">?<i class="arg">...</i>?</span></dt>
<dd><p>Once an instance is created, then it contains the fields listed in the
definition with default values as per the definition. During instance
generation, an object command for the instance is created as well,
using <i class="arg">instanceName</i>. This instance object command is used to
access the data members of the instance. During the instantiation,
values for that instance can be given in key/value pairs.</p>
<p>With every record instance, <b class="method"><i class="arg">conn</i></b> needs to be
associated to enable the instance to communicate with the database
drivers when data manipulation methods <b class="method">add</b>, <b class="method">get</b>,
<b class="method">save</b> and <b class="method">delete</b> are invoked. This
<b class="method"><i class="arg">connectionName</i></b> can be obtained using <i class="arg">db</i> <b class="method">open</b>
method.</p>
<p>Optionally, <i class="arg">#auto</i> can be used in place of <i class="arg">instanceName</i>.
When #auto is used, then an instance name will automatically be
generated, of the form definitionName&lt;integer&gt;, where &lt;integer&gt; is a
unique integer that is generated.</p>
<pre class="example">
# create an object instance addr1 with default values
Address addr1 conn
</pre>
<pre class="example">
# create an object instance addr2 with assigned values
Address addr2 conn -city Chennai -postalcode 638001
</pre>
</dd>
</dl>
</div>
<div id="subsection10" class="subsection"><h3><a name="subsection10">Record Instance Commands</a></h3>
<p>The following subcommands and corresponding arguments are available to
any record instance:</p>
<dl class="definitions">
 
<dt><i class="arg">instanceName</i> <b class="method">cget</b> <span class="opt">?<i class="arg">-field1</i>?</span> <span class="opt">?<i class="arg">-field2</i>?</span> <span class="opt">?<i class="arg">...</i>?</span></dt>
<dd><p>Each instance has the sub command <b class="method">cget</b> associated with it. This
is very similar to how Tk widget's cget command works. It queries
the values of the field for that particular instance. If
no arguments are given, then a key/value list is returned.</p>
<p>To get a value of a field, there are several ways to do this.</p>
<ol class="enumerated">
<li><p>To get a field's value, use the instance built-in <b class="method">cget</b> method:</p>
<pre class="example">
    <i class="arg">addr1</i> <b class="method">cget</b> -city
</pre>
</li>
<li><p>To get multiple field values, you can specify them all in one command:</p>
<pre class="example">
    <i class="arg">addr1</i> <b class="method">cget</b> -addrline1 -addrline2
</pre>
</li>
<li><p>To get a list of the key/value of all of the members, there are 3 ways:</p>
<pre class="example">
    <i class="arg">addr1</i>
    <i class="arg">addr1</i> <b class="method">cget</b>
    <i class="arg">addr1</i> <b class="method">configure</b>
</pre>
</li>
</ol></dd>
<dt><i class="arg">instanceName</i> <b class="method">configure</b> <span class="opt">?<i class="arg">-field1 val1</i>?</span> <span class="opt">?<i class="arg">-field2 val2</i>?</span> <span class="opt">?<i class="arg">...</i>?</span></dt>
<dd><p>Each instance has the sub command <b class="method">configure</b> associated with it. This
is very similar to how Tk widget's configure command works. It sets
the values of the particular field for that particular instance. If
no arguments are given, then a key/value list is returned.</p></dd>
<dt><i class="arg">instanceName</i> <b class="method">clear</b></dt>
<dd><p>Each instance has the sub command <b class="method">clear</b> associated with it. It
sets the values of the particular field to it's initial default value
given in the correponding object definition. Fields that were not given
default initial value are given a value of <b class="const">&lt;undefined&gt;</b>.</p>
<p>To set a value of a field, there are several ways to do this.</p>
<ol class="enumerated">
<li><p>To set a field value:</p>
<pre class="example">
    <i class="arg">addr1</i> <b class="method">configure</b> -addrline1 val1
</pre>
</li>
<li><p>To set multiple field values, you can specify them all in one command:</p>
<pre class="example">
    <i class="arg">addr1</i> <b class="method">configure</b> -addrline1 va1 -addrline2 val2
</pre>
</li>
<li><p>To reset all the field values as per the DAO definition:</p>
<pre class="example">
    <i class="arg">addr1</i> <b class="method">reset</b>
</pre>
</li>
</ol></dd>
<dt><i class="arg">instanceName</i> <b class="method">add</b> <span class="opt">?<i class="arg">-field1</i>?</span> <span class="opt">?<i class="arg">-field2</i>?</span> <span class="opt">?<i class="arg">...</i>?</span></dt>
<dd><p>Each instance has the sub command <b class="method">add</b> associated with it. It 
inserts the object as a new record into database. In preparing the
record to insert, this method prepares a list of name-value pairs,
by default, from all the fields of the object. However, if the optional
arguments are passed, it uses only those field names in the arguments
in preparing the name-value pairs. While preparing the name-value
pairs, it includes only those fields that are initialized with a value
other than &lt;undefined&gt;. Instead of an empty string, we make use
of this state of a field to indicate the absense of a field in the
insert operation (thus resulting in default value as per the schema
definition in the database). To set a field's value to NULL,
<b class="method">configure</b> the same to value <b class="const">&lt;null&gt;</b>. Upon successful
completion of add operation, the new values of sequence /
auto-incremented fields are populated back into the object.</p>
<p>Returns the status of add operation as a numerical value. A value
greater than zero indicates success.</p></dd>
<dt><i class="arg">instanceName</i> <b class="method">get</b> <span class="opt">?<i class="arg">-field1</i>?</span> <span class="opt">?<i class="arg">-field2</i>?</span> <span class="opt">?<i class="arg">...</i>?</span></dt>
<dd><p>Each instance has the sub command <b class="method">get</b> associated with it. It
retrieves a unique record from the database and populates instance's
fields. The process of preparing the condition needed to identify the
unique record from the field values of an instance is explained in
section <span class="sectref"><a href="#section5">Object To Record Mapping</a></span>. By default, this method
retrieves the values for all the fields of the object. However, if the
optional arguments are passed, it retrieves only those fields in the
arguments.</p>
<p>Returns fieldname-value pairs retrieved from database as a Tcl 
dictionary. If the retrieval does not return any record from database,
then the result will be an empty string.</p></dd>
<dt><i class="arg">instanceName</i> <b class="method">save</b> <span class="opt">?<i class="arg">-field1</i>?</span> <span class="opt">?<i class="arg">-field2</i>?</span> <span class="opt">?<i class="arg">...</i>?</span></dt>
<dd><p>Each instance has the sub command <b class="method">save</b> associated with it. It
saves the object by updating the corresponding record into the
database. The process of preparing the condition needed to identify the
unique record from the field values of a DAO instance is explained in
section <span class="sectref"><a href="#section5">Object To Record Mapping</a></span>. In preparing the
record to updte, this method prepares a list of name-value pairs,
by default, from all the fields of the object. However, if the optional
arguments are passed, it uses only those field names in the arguments
to prepare the name-value pairs. While preparing the name-value
pairs, it includes only those fields that are initialized with a value
other than &lt;undefined&gt;. Instead of an empty string, we make use
of this state of a field to indicate the absense of a field in the
update operation (thus not affecting those fields in the database). To
set a field's value to NULL, <b class="method">configure</b> the same to value
<b class="const">&lt;null&gt;</b>.</p>
<p>Returns the status of save operation as a numerical value. A value
greater than zero indicates success.</p></dd>
<dt><i class="arg">instanceName</i> <b class="method">delete</b></dt>
<dd><p>Each instance has the sub command <b class="method">delete</b> associated with it.
It deletes the record from database represented by the object and
resets the object values. The unique record to be deleted from the
database is identified based on the description given in the section
<span class="sectref"><a href="#section5">Object To Record Mapping</a></span>.</p>
<p>Returns the status of delete operation as a numerical value. A value
greater than zero indicates success.</p></dd>
</dl>
</div>
</div>
<div id="section5" class="section"><h2><a name="section5">Object To Record Mapping</a></h2>
<p>tdbo object methods <b class="method">get</b>, <b class="method">save</b> and <b class="method">delete</b>
need to identify a unique record in the database that the object
instance represents. A unique record is identified by the values of
primary key and/or unique fields of the object. Process of defining
these field names are OO system dependent. Please refer to the
corresponding section on how to define and use tdbo objects using the
respective OO system.</p>
<p>For e.g., if the primary key was defined as {pk1 pk2} and unique fields
were defined as {{uq1} {uq2 uq3}} then the condition to be used in
WHERE clause of an SQL statement to identify the unique record will be:</p>
<pre class="example">
((pk1='pk1value' AND pk2='pk2vaue') OR (uq1='uq1value') OR (uq2='uq2value' AND uq3='uq3value'))
</pre>
<p>If any of the fields listed as part of primary key or unique fields are
undefined (un-initialized or unset), then those fields are not included
in the condition. For e.g., if pk1 is undefined, then the condition
will be:</p>
<pre class="example">
((uq1='uq1value') OR (uq2='uq2value' AND uq3='uq3value'))
</pre>
<p>Or, for e.g., if uq2 is undefined, then the condition will be:</p>
<pre class="example">
((pk1='pk1value' AND pk2='pk2vaue') OR (uq1='uq1value')).
</pre>
<p>Or, for e.g., if uq1 is undefined, then the condition will be:</p>
<pre class="example">
((pk1='pk1value' AND pk2='pk2vaue') OR (uq2='uq2value' AND uq3='uq3value')).
</pre>
<p>If any of the fields listed as part of primary key or unique fields are
set to &lt;null&gt;, then its value is replaced with \&quot;IS NULL\&quot; in the
condition. For e.g., if pk1 is undefined and uq1 is set to &lt;null&gt;, then
the condition will be:</p>
<pre class="example">
((uq1 IS NULL) OR (uq2='uq2value' AND uq3='uq3value'))
</pre>
</div>
<div id="section6" class="section"><h2><a name="section6">EXAMPLES</a></h2>
<p>Following example gives a step-by-step illustration on how to use
this package.</p>
<pre class="example">
#
# Example goes here
#
</pre>
</div>
<div id="section7" class="section"><h2><a name="section7">See Also</a></h2>
<p><b class="cmd">struct::record</b>, <b class="cmd">tdao::dbc</b> and <b class="cmd">tdao::dao</b></p>
</div>
<div id="section8" class="section"><h2><a name="section8">AUTHOR</a></h2>
<p>Nagarajan Chinnasamy &lt;nagarajanchinnasamy@gmail.com&gt;</p>
</div>
<div id="section9" class="section"><h2><a name="section9">BUGS, IDEAS, FEEDBACK</a></h2>
<p>This document, and the package it describes, will undoubtedly contain
bugs and other problems.
Please report such problems at GitHub 
<a href="https://github.com/nagarajanchinnasamy/tdbo/issues">Issues Page</a>.
Please also report any ideas for enhancements you may have for either
package and/or documentation.</p>
</div>
<div id="keywords" class="section"><h2><a name="keywords">Keywords</a></h2>
<p>DAO, Data Access Objects, Database Connectivity</p>
</div>
<div id="category" class="section"><h2><a name="category">Category</a></h2>
<p>Database</p>
</div>
<div id="copyright" class="section"><h2><a name="copyright">Copyright</a></h2>
<p>Copyright &copy; 2013, Nagarajan Chinnasamy &lt;nagarajanchinnasamy@gmail.com&gt;</p>
</div>
</div></body></html>
