
<html><head>
<title>tdbo - Tcl DataBase Objects</title>
<style type="text/css"><!--
    HTML {
	background: 	#FFFFFF;
	color: 		black;
    }
    BODY {
	background: 	#FFFFFF;
	color:	 	black;
    }
    DIV.doctools {
	margin-left:	10%;
	margin-right:	10%;
    }
    DIV.doctools H1,DIV.doctools H2 {
	margin-left:	-5%;
    }
    H1, H2, H3, H4 {
	margin-top: 	1em;
	font-family:	sans-serif;
	font-size:	large;
	color:		#005A9C;
	background: 	transparent;
	text-align:		left;
    }
    H1.title {
	text-align: center;
    }
    UL,OL {
	margin-right: 0em;
	margin-top: 3pt;
	margin-bottom: 3pt;
    }
    UL LI {
	list-style: disc;
    }
    OL LI {
	list-style: decimal;
    }
    DT {
	padding-top: 	1ex;
    }
    UL.toc,UL.toc UL, UL.toc UL UL {
	font:		normal 12pt/14pt sans-serif;
	list-style:	none;
    }
    LI.section, LI.subsection {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding: 	0em;
    }
    PRE {
	display: 	block;
	font-family:	monospace;
	white-space:	pre;
	margin:		0%;
	padding-top:	0.5ex;
	padding-bottom:	0.5ex;
	padding-left:	1ex;
	padding-right:	1ex;
	width:		100%;
    }
    PRE.example {
	color: 		black;
	background: 	#f5dcb3;
	border:		1px solid black;
    }
    UL.requirements LI, UL.syntax LI {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding:	0em;
    }
    DIV.synopsis {
	color: 		black;
	background: 	#80ffff;
	border:		1px solid black;
	font-family:	serif;
	margin-top: 	1em;
	margin-bottom: 	1em;
    }
    UL.syntax {
	margin-top: 	1em;
	border-top:	1px solid black;
    }
    UL.requirements {
	margin-bottom: 	1em;
	border-bottom:	1px solid black;
    }
--></style>
</head>
<! -- Generated from file 'tdbo.man' by tcllib/doctools with format 'html'
   -->
<! -- Copyright &copy; 2013, Nagarajan Chinnasamy &lt;nagarajanchinnasamy@gmail.com&gt;
   -->
<! -- CVS: $Id$ tdbo.n
   -->
<body><div class="doctools">
<h1 class="title">tdbo(n) 0.1.4 tdbo &quot;Tcl DataBase Objects&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>tdbo - Framework that provides Object Oriented Access to a Data Store</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">TDBO Commands</a></li>
<li class="section"><a href="#section3">TDBO Driver Commands</a></li>
<li class="section"><a href="#section4">TDBO Connection Commands</a></li>
<li class="section"><a href="#section5">TDBO Object Commands</a></li>
<li class="section"><a href="#section6">tdbo::Itcl::DBObject Class</a></li>
<li class="section"><a href="#section7">EXAMPLES</a></li>
<li class="section"><a href="#section8">See Also</a></li>
<li class="section"><a href="#section9">AUTHOR</a></li>
<li class="section"><a href="#section10">BUGS, IDEAS, FEEDBACK</a></li>
<li class="section"><a href="#keywords">Keywords</a></li>
<li class="section"><a href="#category">Category</a></li>
<li class="section"><a href="#copyright">Copyright</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="requirements">
<li>package require <b class="pkgname">tdbo</b></li>
</ul>
<ul class="syntax">
<li><a href="#1"><b class="cmd">tdbo load</b> <i class="arg">driver</i></a></li>
<li><a href="#2"><i class="arg">db</i> <b class="cmd">open</b> <i class="arg">args</i></a></li>
<li><a href="#3"><i class="arg">conn</i> <b class="cmd">close</b></a></li>
<li><a href="#4"><i class="arg">conn</i> <b class="cmd">conn</b></a></li>
<li><a href="#5"><i class="arg">obj</i> <b class="cmd">add</b> <i class="arg">memberslist</i></a></li>
<li><a href="#6"><i class="arg">obj</i> <b class="cmd">delete</b></a></li>
<li><a href="#7"><i class="arg">obj</i> <b class="cmd">get</b> <i class="arg">memberslist</i></a></li>
<li><a href="#8"><i class="arg">obj</i> <b class="cmd">save</b> <i class="arg">memberslist</i></a></li>
<li><a href="#9"><i class="arg">obj</i> <b class="cmd">add</b> <i class="arg">memberslist</i></a></li>
<li><a href="#10"><i class="arg">obj</i> <b class="cmd">delete</b></a></li>
<li><a href="#11"><i class="arg">obj</i> <b class="cmd">get</b> <i class="arg">memberslist</i></a></li>
<li><a href="#12"><i class="arg">obj</i> <b class="cmd">save</b> <i class="arg">memberslist</i></a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>The <b class="cmd">tdbo</b> package provides an object oriented mechanism to access
data in data stores. A tdbo object instance provides <b class="cmd">add</b>,
<b class="cmd">get</b>, <b class="cmd">save</b> and <b class="cmd">delete</b> methods to manipulate data in
the data store. In addition, they provide <b class="cmd">configure</b> and <b class="cmd">cget</b>
methods to access data members of an instance in a standard tcl-ish
style.</p>
<p>A data-store-driver is the one that implements necessary connectivity
mechanism and procedures to access the data store. <b class="cmd">tdbo::load</b>
method is used to load a specific data-store-driver instance. Using
<b class="cmd">open</b> method of a data-store-driver instance, an application
obtains one or many connection handles to the data store. During the
instantiation of a tdbo object, a connection handle is passed on to it
to make use of the connection handle to perform <b class="cmd">add</b>, <b class="cmd">get</b>,
<b class="cmd">save</b> and <b class="cmd">delete</b> methods on the data store.</p>
<p>A data-store-driver, may also provide other methods to 1) retrieve /
manipulate multiple insances of data objects based on filtering
conditions, sorting and grouping criteria 2) perform atomic and
concurrent transactions 3) etc... Applications can make use of the
connection handle to perform such operations and create instances of
tdbo objects from resulting data.</p>
<p>Currently, tdbo supports <b class="const">sqlite3</b>, <b class="const">mysqltcl</b>,
<b class="const">Pgtcl</b>, <b class="const">tdbc::sqlite3</b>, <b class="const">tdbc::mysql</b> and
<b class="const">tdbc::postgres</b> drivers. Note that sqlite3, mysqltcl and
Pgtcl drivers are functional in both Tcl 8.5 and Tcl 8.6
environments while tdbc is available only on Tcl 8.6 and above.</p>
<p>tdbo objects can be defined in various ways based on the OO-system that
is used by the application. For e.g., tdbo object can be defined in
Itcl by inheriting <b class="cmd">tdbo::Itcl::DBObject</b> class. Similarly ....</p>
</div>
<div id="section2" class="section"><h2><a name="section2">TDBO Commands</a></h2>
<dl class="definitions">
<dt><a name="1"><b class="cmd">tdbo load</b> <i class="arg">driver</i></a></dt>
<dd><p>Loads a data-store-driver and returns a handle to the driver instance.
<i class="arg">driver</i> can be one of <b class="const">sqlite3</b>, <b class="const">mysqltcl</b>,
<b class="const">Pgtcl</b>, <b class="const">tdbc::sqlite3</b>, <b class="const">tdbc::mysql</b> and
<b class="const">tdbc::postgres</b></p></dd>
</dl>
</div>
<div id="section3" class="section"><h2><a name="section3">TDBO Driver Commands</a></h2>
<dl class="definitions">
<dt><a name="2"><i class="arg">db</i> <b class="cmd">open</b> <i class="arg">args</i></a></dt>
<dd><p>Where <i class="arg">db</i> is the data-store-driver instance handle returned by
<b class="cmd">tdbo load</b> command. This command establishes a new connection to
the database and returns the connection handle. Arguments are driver
dependent. Please refer to the documentation of respective driver.</p></dd>
</dl>
</div>
<div id="section4" class="section"><h2><a name="section4">TDBO Connection Commands</a></h2>
<dl class="definitions">
<dt><a name="3"><i class="arg">conn</i> <b class="cmd">close</b></a></dt>
<dd><p>Definition...</p></dd>
<dt><a name="4"><i class="arg">conn</i> <b class="cmd">conn</b></a></dt>
<dd><p>Definition...</p></dd>
</dl>
<p>Driver may provide other commands to perform....</p>
</div>
<div id="section5" class="section"><h2><a name="section5">TDBO Object Commands</a></h2>
<p>Instantiate a tdbo object based on the OO-system....</p>
<dl class="definitions">
<dt><a name="5"><i class="arg">obj</i> <b class="cmd">add</b> <i class="arg">memberslist</i></a></dt>
<dd><p>Definition...</p></dd>
<dt><a name="6"><i class="arg">obj</i> <b class="cmd">delete</b></a></dt>
<dd><p>Definition...</p></dd>
<dt><a name="7"><i class="arg">obj</i> <b class="cmd">get</b> <i class="arg">memberslist</i></a></dt>
<dd><p>Definition...</p></dd>
<dt><a name="8"><i class="arg">obj</i> <b class="cmd">save</b> <i class="arg">memberslist</i></a></dt>
<dd><p>Definition...</p></dd>
</dl>
</div>
<div id="section6" class="section"><h2><a name="section6">tdbo::Itcl::DBObject Class</a></h2>
<p>Instantiate a tdbo object based on the OO-system....</p>
<dl class="definitions">
<dt><a name="9"><i class="arg">obj</i> <b class="cmd">add</b> <i class="arg">memberslist</i></a></dt>
<dd><p>Definition...</p></dd>
<dt><a name="10"><i class="arg">obj</i> <b class="cmd">delete</b></a></dt>
<dd><p>Definition...</p></dd>
<dt><a name="11"><i class="arg">obj</i> <b class="cmd">get</b> <i class="arg">memberslist</i></a></dt>
<dd><p>Definition...</p></dd>
<dt><a name="12"><i class="arg">obj</i> <b class="cmd">save</b> <i class="arg">memberslist</i></a></dt>
<dd><p>Definition...</p></dd>
</dl>
</div>
<div id="section7" class="section"><h2><a name="section7">EXAMPLES</a></h2>
<p>Following example gives a step-by-step illustration on how to use
this package.</p>
<pre class="example">
#
# Step 0: Setup a database named employee using the employee_schema.sql
#         found in the respective sub-folder in demo folder. Create
#         necessary user account and previleges.
#
# Step 1: Load tdao package and import dao and dbc commands
#
#
package require tdao
namespace import -force tdao::dao::dao
namespace import -force tdao::dbc::dbc
</pre>
<pre class="example">
#
# Step 2: Load Database connectivity module and open a connection.
#         Un/Comment lines below as necessary
#
#
set db [dbc load sqlite]
set conn [$db open [file normalize &quot;sqlite/employee.db&quot;]]
#~ set db [dbc load postgres]
#~ set conn [$db open employee -user nagu -password Welcome123]
#~ set db [dbc load mariadb]
#~ set conn [$db open employee -user nagu -password Welcome123]
</pre>
<pre class="example">
#
# Step 3: Define Data Access Objects (DAO): address &amp; employee
#
#
puts [dao define Address  address {
    id
    addrline1
    addrline2
    {city Bangalore}
    {postalcode 560001}
    {country India}
} -primarykey id -autoincrement id]
#
#
puts [dao define Employee  employee {
    id
    name
    rollno
    address_id
} -primarykey id -autoincrement id]
</pre>
<pre class="example">
#
# Step 4: Define Transactions: save_employee
#
#
proc save_employee {conn op emp addr} {
  $conn begin
    switch $op {
      add {
        if {[catch {$addr add} err]} {
          $conn rollback
          return -code error $err
        }
        $emp configure -address_id [$addr cget -id]
        if {[catch {$emp add} err]} {
          $conn rollback
          return -code error $err
        }
      }
      update {
        if {[catch {$addr save} err]} {
          $conn rollback
          return -code error $err
        }
        if {[catch {$emp save} err]} {
          $conn rollback
          return -code error $err
        }          
      }
    }
  $conn commit
  return 1
}
</pre>
<pre class="example">
#
# Step 5: Instantiate DAOs address &amp; employee
#
#
Employee emp $conn -name &quot;Employee Name1&quot; -rollno &quot;INBNG0001&quot;
puts &quot;Employee before adding: [emp cget]&quot;
Address addr $conn  -addrline1 &quot;Address Line 1&quot;  -addrline2 &quot;Address Line 2&quot;
puts &quot;Address before adding: [addr cget]&quot;
</pre>
<pre class="example">
#
# Step 6: Add/Modify employee &amp; address
#
#
if {[catch {save_employee $conn add emp addr} err]} {
  puts &quot;Saving employee failed...\nError: $err&quot;
  $conn close
  exit
}
puts &quot;Employee after adding: [emp cget]&quot;
puts &quot;Address after adding: [addr cget]&quot;
# Modify and save Address object.
addr configure  -addrline1 &quot;Updated Address Line 1&quot;  -addrline2 &quot;Updated Address Line 2&quot;  -city &quot;Updated City Name&quot;  -country &quot;Updated Country Name&quot;  -postalcode &quot;Updated Postal Code&quot;
addr save
# Check if the changes are reflected by retrieving it from database
addr reset
puts &quot;Reset address: [addr cget]&quot;
addr configure -id [emp cget -address_id]
addr get
puts &quot;Modified address: [addr cget]&quot;
</pre>
<pre class="example">
#
# Step 7: Clean up and close the database connection
#
#
dao delete instances addr emp
dao delete definition Address Employee
$conn close
</pre>
</div>
<div id="section8" class="section"><h2><a name="section8">See Also</a></h2>
<p><b class="cmd">struct::record</b>, <b class="cmd">tdao::dbc</b> and <b class="cmd">tdao::dao</b></p>
</div>
<div id="section9" class="section"><h2><a name="section9">AUTHOR</a></h2>
<p>Nagarajan Chinnasamy &lt;nagarajanchinnasamy@gmail.com&gt;</p>
</div>
<div id="section10" class="section"><h2><a name="section10">BUGS, IDEAS, FEEDBACK</a></h2>
<p>This document, and the package it describes, will undoubtedly contain
bugs and other problems.
Please report such in the category <em>tdao</em> of the
<a href="http://sourceforge.net/tracker/?group_id=12883">Tcllib SF Trackers</a>.
Please also report any ideas for enhancements you may have for either
package and/or documentation.</p>
</div>
<div id="keywords" class="section"><h2><a name="keywords">Keywords</a></h2>
<p>DAO, Data Access Objects, Database Connectivity</p>
</div>
<div id="category" class="section"><h2><a name="category">Category</a></h2>
<p>Database</p>
</div>
<div id="copyright" class="section"><h2><a name="copyright">Copyright</a></h2>
<p>Copyright &copy; 2013, Nagarajan Chinnasamy &lt;nagarajanchinnasamy@gmail.com&gt;</p>
</div>
</div></body></html>
