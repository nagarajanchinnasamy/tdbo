<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
      "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>tdbo::DBObject</title>
  <meta name="generator" content="Amaya, see http://www.w3.org/Amaya/">
  <style type="text/css" title="Amaya theme">
/* Modern style for Amaya Editor Lite */

/* default rules for the whole document */
body {
    font-size: 12pt;
    font-family: Helvetica, Arial, sans-serif;
    font-weight: normal;
    font-style: normal;
    color: black;
    background-color: white;
    line-height: 1.2em;
    margin-left: 4em;
    margin-right: 2em;
   }

/* paragraphs */
p  {
    padding: 0;
    margin-top: 1em;
    margin-bottom: 1em;
    text-align: left;
   }

/* headings */
h1 {
    font-size: 180%;
    font-weight: bold;
    font-style: normal;
    font-variant: small-caps;
    text-align: left;
    padding: 0;
    margin-top: 1.7em;
    margin-bottom: 1.7em;
   }
h2 {
    font-size: 150%;
    font-weight: bold;
    font-style: normal;
    padding: 0;
    margin-top: 1.5em;
    margin-bottom: 1.1em;
   }
h3 {
    font-size: 130%;
    font-weight: bold;
    font-style: normal;
    padding: 0;
    margin-top: 1.3em;
    margin-bottom: 1.1em;
   }
h4 {
    font-size: 110%;
    font-weight: bold;
    font-style: normal;
    padding: 0;
    margin-top: 1.1em;
    margin-bottom: 1.1em;
   }
h5 {
    font-size: 100%;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin-top: 1em;
    margin-bottom: 1em;
   }
h6 {
    font-size: 100%;
    font-weight: normal;
    font-style: italic;
    padding: 0;
    margin-top: 1em;
    margin-bottom: 1em;
   }

/* divisions */
div {
    padding: 0;
    margin-top: 0em;
    margin-bottom: 0em;
   }

/* lists */
ul, ol {
    padding: 0 0 0 3em;
    margin-top: 1em;
    margin-bottom: 1em;
   }
ul ul, ol ol, ul ol, ol ul {
    margin-top: 1em;
    margin-bottom: 1em;
   }
li {
    padding: 0;
    margin-top: 1em;
    margin-bottom: 1em;
    text-align: left;
   }
li p {
    margin-top: 1em;
    margin-bottom: 1em;
   }
dl {
    padding: 0;
    margin-top: 1em;
    margin-bottom: 1em;
    margin-left: 1em;
   }
dl dl {
    margin-top: 0em;
    margin-bottom: 0em;
   }
dt {
    padding: 0;
    font-weight: bold;
    margin-top: .3em;
    margin-bottom: .3em;
   }
dd {
    padding: 0;
    margin-top: .3em;
    margin-left: 3em;
    margin-bottom: .3em;
   }
dl p {
    margin-top: .3em;
    margin-bottom: .3em;
   }

/* inline */
strong {
    font-weight: bold;
   }
em {
    font-style: italic;
   }
code {
    font-family: Courier New, Courier, monospace;
   }
ins {
    background-color: yellow;
    text-decoration: underline;
   }
del {
    text-decoration: line-through;
   }

/* anchors */
a[href] {
    color: blue;
    text-decoration: underline;
   }

hr {
  border: 0;
  width: 100%;
  color: #f00;
  background-color: #f00;
  height: 1px;
}

th {
  background-color: #CCCCFF;
  text-align: left;
}

td {
  vertical-align: top;
}

/* end */
  </style>
</head>

<body>
<h1><a href="index.html">TDBO</a> - Tcl DataBase Object</h1>
<br>
<br>


<table border="0" style="width: 100%">
  <col>
  <tbody>
    <tr>
      <td align="center" colspan="1"><a href="reference.html">Table Of
        Contents</a></td>
    </tr>
  </tbody>
</table>
<br>
<br>
<a id="Sections"></a> 

<h3>Sections</h3>
<dl>
    <dd><a href="#ClassSummary">Class Summary</a></dd>
    <dd><a href="#Inheritance">Inheritance</a></dd>
    <dd><a href="#ConstructorSummary">Constructor Summary</a></dd>
    <dd><a href="#ProcMethodsSummary">Proc/Methods Summary</a></dd>
    <dd><a href="#ConstructorDetail">Constructor Detail</a></dd>
    <dd><a href="#ProcMethodDetail">Proc/Method Detail</a></dd>
    <dd><a href="#ORMapping">Object To Database Record Mapping</a></dd>
    <dd><a href="#Example">Example DBObject Class</a></dd>
</dl>
<br>
<br>


<table border="1" style="width: 100%">
  <tbody>
    <tr>
      <th><strong><a id="ClassSummary"></a>Class: tdbo::DBObject</strong></th>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td>Data Access Object class that needs to be inherited by
        application-specific object classes (eg., Employee, PurchaseItem etc.).
        This class cannot be instantiated directly.</td>
    </tr>
  </tbody>
</table>
<br>
<br>


<table border="1" style="width: 100%">
  <tbody>
    <tr>
      <th><strong><a id="Inheritance"></a>Inherits: <a
        href="object.html">tdbo::Object</a></strong></th>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td>Methods: <a href="object.html#cget">cget</a>, <a
        href="object.html#clear">clear</a>, <a
        href="object.html#configure">configure</a> 

        <p>Variables: <a href="object.html#clsName">clsName</a>, <a
        href="object.html#log">log</a></p>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>


<table border="1" style="width: 100%">
  <tbody>
    <tr>
      <th colspan="2"><strong><a id="ConstructorSummary"></a>Constructor
        Summary</strong></th>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td><a href="#constructor">constructor {db}</a></td>
      <td>Stores the definition of primary keys, unique fields and sequence /
        auto-increment fields by invoking following protected methods: <code><a
        href="#_define_primarykey">_define_primarykey</a></code>, <code><a
        href="#_define_unique">_define_unique</a></code> and <code><a
        href="#_define_autoincrement">_define_autoincrement</a></code>. Also
        prepares list of field names for later usage by insert and update
        operations.</td>
    </tr>
  </tbody>
</table>
<br>
<br>


<table border="1" style="width: 100%">
  <tbody>
    <tr>
      <th colspan="2"><strong><a id="ProcMethodsSummary"></a>Proc/Methods
        Summary</strong></th>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td nowrap="nowrap" align="right"><code>public proc</code> </td>
      <td><code><a href="#schema_name">schema_name {}</a></code> 

        <p>Returns name of the table / view that this class represents.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>public method</code> </td>
      <td><code><a href="#add">add {args}</a></code> 

        <p>Save object in the database by inserting a new record.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>public method</code> </td>
      <td><code><a href="#delete">delete {}</a></code> 

        <p>Delete associated record from database and reset object values.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>public method</code> </td>
      <td><code><a href="#get">get {args}</a></code> 

        <p>Retrieve associated record from database and refresh object's
        values.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>public method</code> </td>
      <td><code><a href="#save">save {args}</a></code> 

        <p>Save object by updating the associated record in the database.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>protected method</code> </td>
      <td><code><a href="#define_autoincrement">define_autoincrement
        {args}</a></code> 

        <p>Define a list of public variable names that map to auto-incremented
        (also known as sequence) fields.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>protected method</code> </td>
      <td><code><a href="#define_primarykey">define_primarykey
        {args}</a></code> 

        <p>Define a list of public variable names that map to primary key
        fields.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>protected method</code> </td>
      <td><code><a href="#define_unique">define_unique {args}</a></code> 

        <p>Define a list of list of public variable names with each list
        mapping to a set of fields that help uniquely identify a record.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>protected method</code> </td>
      <td><code><a href="#_define_autoincrement">_define_autoincrement
        {args}</a></code> 

        <p>Provides a default implementation by invoking
        <code>define_autoincrement</code> with an empty list. Override this
        method to invoke <code><a
        href="#define_autoincrement">define_autoincrement</a></code> with your
        own list of public variable names.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>protected method</code> </td>
      <td><code><a href="#_define_primarykey">_define_primarykey {}</a></code> 

        <p>Provides a default implementation by invoking
        <code>define_primarykey</code> with an empty list. Override this method
        to invoke <code><a
        href="#define_primarykey">define_primarykey</a></code> with your own
        list of public variable names.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>protected method</code> </td>
      <td><code><a href="#_define_unique">_define_unique {}</a></code> 

        <p>Provides a default implementation by invoking
        <code>define_unique</code> with an empty list. Override this method to
        invoke <code><a href="#define_unique">define_unique</a></code> with
        your own list of list of public variable names.</p>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>


<table border="1" style="width: 100%">
  <tbody>
    <tr>
      <th><strong><a id="ConstructorDetail"></a>Constructor Detail</strong></th>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td><dl>
          <dt><a id="constructor"></a><code><strong>constructor
          {db}</strong></code> </dt>
            <dd>Stores the definition of primary keys, unique fields and
              sequence / auto-increment fields by invoking following protected
              methods: <code><a
              href="#_define_primarykey">_define_primarykey</a></code>,
              <code><a href="#_define_unique">_define_unique</a></code> and
              <code><a
              href="#_define_autoincrement">_define_autoincrement</a></code>.
              Also prepares list of field names for later usage by insert and
              update operations. 
              <dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd>db - instance of one of the Database Connectivity classes
                    tdbo::SQLite, tdbo::MariaDB and tdbo::PostgreSQL.</dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>


<table border="1" style="width: 100%">
  <tbody>
    <tr>
      <th><strong><a id="ProcMethodDetail"></a>Proc/Method Detail</strong></th>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td><dl>
          <dt><code><strong><a id="add"></a>public method add
          {args}</strong></code> </dt>
            <dd>Insert the object as a new record into database. In preparing
              the record to insert, this method prepares a list of name-value
              pairs, by default, from all public member variables of the
              object. However, if the argument args is passed, it uses only
              those field names in the args-list in preparing the name-value
              pairs. While preparing the name-value pairs, it includes only
              those member variables that are initialized with a value other
              than "&lt;undefined&gt;". In Itcl, Member variables that are
              uninitialized or unset are internally identified with the value
              "&lt;undefined&gt;". We make use of this state of a member
              variable to omit a field in the insert operation. To set a
              particular field's value to NULL, you need to set the value of
              the corresponding public member variable to "&lt;null&gt;". Upon
              successful completion of add operation, the new values of
              sequence / auto-incremented fields are populated back into the
              object.</dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>Optional list of public member variable names that
                          represent the fields in the database record that
                          needs to be inserted. When provided, only the fields
                          in this list are used in insert operation. Otherwise,
                          by default, all public member variable names are used
                          as list of field names in the insert operation.</dd>
                    </dl>
                  </dd>
                <dt><strong>Returns:</strong></dt>
                  <dd>Returns the status of add operation as a numerical value.
                    A value greater than zero indicates success. Upon failure,
                    logs the error message and returns 0.</dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="delete"></a>public method delete
          {}</strong></code> </dt>
            <dd>delete the record represented by the object from database and
              reset the object values. The record to be deleted from the
              database is identified based on the description provided in <a
              href="#ORMapping">Object To Database Record Mapping</a>.</dd>
            <dd><dl>
                <dt><strong>Returns:</strong></dt>
                  <dd>Returns the status of add operation as a numerical value.
                    A value greater than zero indicates success. Upon failure,
                    logs the error message and returns 0.</dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="get"></a>public method get
          {args}</strong></code> </dt>
            <dd>Retrieve a record from the database and populate object's
              member variables with values retrieved. The record to be
              retrieved from the database is identified based on the
              description provided in <a href="#ORMapping">Object To Database
              Record Mapping</a>. By default, this method uses all public
              member variable names as the fields of the record to be retrieved
              from the database. However, if the argument args is passed with a
              list of field names (corresponding to its public member
              variables), then only those fields are retrieved and populated
              into the object.</dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>Optional list of public member variable names that
                          represent the fields in the database record that
                          needs to be retrieved. When provided, only the fields
                          in this list are used in getting values from
                          database. Otherwise, by default, all public member
                          variable names are used as list of field names to get
                          values from database.</dd>
                    </dl>
                  </dd>
                <dt><strong>Returns:</strong></dt>
                  <dd>fieldname-value pairs retrieved from database as a Tcl
                    dictionary. If the retrieval does not return any record
                    from database, then the result will be an empty string.</dd>
                <dt><strong>Throws:</strong></dt>
                  <dd>an error if the retrieval resulted in getting more than
                    one record.</dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="save"></a>public method save
          {args}</strong></code> </dt>
            <dd>Save the object by updating the corresponding record in the
              database. The record to be updated in the database is identified
              based on the description provided in <a href="#ORMapping">Object
              To Database Record Mapping</a>. In preparing the record to save,
              this method prepares a list of name-value pairs, by default, from
              all public member variables of the object. However, if the
              argument args is passed, it uses only those field names in the
              args-list in preparing the name-value pairs. While preparing the
              name-value pairs, it includes only those member variables that
              are initialized with a value other than &lt;undefined&gt;. In
              Itcl, member variables that are not initialized or unset are
              internally identified with the value &lt;undefined&gt;. We make
              use of this state of a member variable to omit a field in the
              update operation. To set a particular field's value to NULL, you
              need to set the value of the corresponding public member variable
              to "&lt;null&gt;". </dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>Optional list of public member variable names that
                          represent the fields in the database record that
                          needs to be updated. When provided, only the fields
                          in this list are used in update operation. Otherwise,
                          by default, all public member variable names are used
                          as list of field names to update their values in the
                          database.</dd>
                    </dl>
                  </dd>
                <dt><strong>Returns:</strong></dt>
                  <dd>the status of save operation as a numerical value. A
                    value greater than zero indicates success. Upon failure,
                    logs the error and returns 0.</dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="define_autoincrement"></a>protected method
          define_autoincrement {args}</strong></code> </dt>
            <dd>Define a list of public variable names that are
              auto-incremented (also known as sequence fields) by the database
              whenever a new record is inserted. This method is meant to be
              invoked by derived classes from within <code><a
              href="#_define_autoincrement">_define_autoincrement</a></code>
              method.</dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>a list containing fieldnames that are
                          autoincrement/sequence fields.</dd>
                    </dl>
                  </dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="define_primarykey"></a>protected method
          define_primarykey {args}</strong></code> </dt>
            <dd>Define a list of public variable names that map to the primary
              key fields of the associated table/view in the database. This
              method is meant to be invoked by derived classes from within
              <code><a href="#_define_primarykey">_define_primarykey</a></code>
              method.</dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>a list of field names that constitute the primary
                          key.</dd>
                    </dl>
                  </dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="define_unique"></a>protected method
          define_unique {args}</strong></code> </dt>
            <dd>Define a list of list of public variable names with each list
              mapping to a set of fields that identify a record of the
              associated table/view in the database uniquely. This method is
              meant to be invoked by derived classes from within <code><a
              href="#_define_unique">_define_unique</a></code> method. </dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>a list of lists with each list containing field
                          names that constitute a unique key.</dd>
                    </dl>
                  </dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="_define_autoincrement"></a>protected method
          _define_autoincrement {args}</strong></code> </dt>
            <dd>Provides a default implementation by invoking
              <code>define_autoincrement</code> with an empty list. Override
              this method to invoke <code><a
              href="#define_autoincrement">define_autoincrement</a></code> with
              your own list of public variable names.</dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>a list containing fieldnames that are
                          autoincrement/sequence fields.</dd>
                    </dl>
                  </dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="_define_primarykey"></a>protected method
          _define_primarykey {args}</strong></code> </dt>
            <dd>Provides a default implementation by invoking define_primarykey
              with an empty list. Override this method to invoke <code><a
              href="#define_primarykey">define_primarykey</a></code> with your
              own list of public variable names.</dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>a list of field names that constitute the primary
                          key.</dd>
                    </dl>
                  </dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="_define_unique"></a>protected method
          _define_unique {args}</strong></code> </dt>
            <dd>Provides a default implementation by invoking define_unique
              with an empty list. Override this method to invoke <code><a
              href="#define_unique">define_unique</a></code> with your own list
              of list of public variable names. </dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>a list of lists with each list containing field
                          names that constitute a unique key.</dd>
                    </dl>
                  </dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>


<table border="1" style="width: 100%">
  <col>
  <tbody>
    <tr>
      <th><strong><a id="ORMapping"></a>Object To Database Record
        Mapping</strong></th>
    </tr>
    <tr>
      <td>The record to be retrieved/saved/deleted in the database is uniquely
        identified by the values of primary key or unique member variables of
        the object. An application object class (e.g., Employee) derived from
        DBObject class implements _define_primarykey and _define_unique methods
        to list the fields that can be used to uniquely identify a record in
        the database that an object instance represents. 

        <p>For e.g., if the primary key was defined as {pk1 pk2} and unique
        fields are defined as {{uq1} {uq2 uq3}} then the condition to be used
        in WHERE clause of SQL to identify the unique record will be:
        <code>((pk1='pk1value' AND pk2='pk2vaue') OR (uq1='uq1value') OR
        (uq2='uq2value' AND uq3='uq3value'))</code>.</p>

        <p>If any of the public member variables listed as primary key or
        unique fields are uninitialized (i.e., having the value
        &lt;undefined&gt;), then those fields are not included in the
        condition. For e.g., if pk1 is uninitialized, then the condition will
        be: <code>((uq1='uq1value') OR (uq2='uq2value' AND
        uq3='uq3value'))</code>. Or, for e.g., if uq2 is uninitialized, then
        the condition will be: <code>((pk1='pk1value' AND pk2='pk2vaue') OR
        (uq1='uq1value'))</code>. Or, for e.g., if uq1 is uninitialized, then
        the condition will be: <code>((pk1='pk1value' AND pk2='pk2vaue') OR
        (uq2='uq2value' AND uq3='uq3value'))</code>.</p>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>


<table border="1" style="width: 100%">
  <col>
  <tbody>
    <tr>
      <th><strong><a id="Example"></a>An Example Application Object
        Class</strong></th>
    </tr>
    <tr>
      <td><pre># Step-1: Load tdbo package

package require tdbo

# Step-2: Define Data Access Object class
# Before this step, we assume that you already have
# setup address.db with a table named address is defined.

itcl::class Address {
    inherit tdbo::DBObject

    constructor {db args} {tdbo::DBObject::constructor $db} {
        configure {*}$args
    }
    destructor {
    }

    public proc schema_name {} {
        return "address"
    }

    public variable id
    public variable addrline1
    public variable addrline2
    public variable city
    public variable postalcode
    public variable country

    protected method _define_primarykey {} {
        define_primarykey id
    }
    protected method _define_autoincrement {} {
        define_autoincrement id
    }
}

# Step-3: Instantiate SQLite Database Connectivity Implementation class
set db [::tdbo::SQLite #auto -location address.db]

# Step-4: Open Database Connection
$db open

# Step-5: Instantiate DAO and invoke CRUD methods
Address addr $db \
    -id -1 \
    -addrline1 "Address Line 1" \
    -addrline2 "Address Line 2" \
    -city "City Name" \
    -country "Country Name" \
    -postalcode "560000"

# Add to database
puts "Add: [addr add]"

# Retrieve values
set id [addr cget -id]
addr clear
addr configure -id $id
puts "Get: [addr get]"

# Modify values and save
addr configure -city "My New City" -postalcode "987656"
puts "[addr save city postalcode]"
puts "Modified Values: [addr cget]"

# Delete
puts [addr delete]
puts "After Delete: [addr cget]"

# Step-6: Close the database connection
$db close

# End
        </pre>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>


<table border="0" style="width: 100%">
  <tbody>
    <tr>
      <td align="center"><a href="#Sections">Sections</a></td>
      <td align="center"><a href="reference.html">Table Of Contents</a></td>
    </tr>
  </tbody>
</table>
<br>
<br>
<br>

<hr>

<p>Copyright (c) 2013 by Nagarajan Chinnasamy
&lt;nagarajanchinnasamy@gmail.com&gt;. See <a href="license.html">License</a>
for information on usage and redistribution</p>
</body>
</html>
