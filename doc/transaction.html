<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
      "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <title>transaction</title>
  <meta name="generator" content="Amaya, see http://www.w3.org/Amaya/" />
  <style type="text/css" title="Amaya theme">
/* Modern style for Amaya Editor Lite */

/* default rules for the whole document */
body {
    font-size: 12pt;
    font-family: Helvetica, Arial, sans-serif;
    font-weight: normal;
    font-style: normal;
    color: black;
    background-color: white;
    line-height: 1.2em;
    margin-left: 4em;
    margin-right: 2em;
   }

/* paragraphs */
p  {
    padding: 0;
    margin-top: 1em;
    margin-bottom: 1em;
    text-align: left;
   }

/* headings */
h1 {
    font-size: 180%;
    font-weight: bold;
    font-style: normal;
    font-variant: small-caps;
    text-align: left;
    padding: 0;
    margin-top: 1.7em;
    margin-bottom: 1.7em;
   }
h2 {
    font-size: 150%;
    font-weight: bold;
    font-style: normal;
    padding: 0;
    margin-top: 1.5em;
    margin-bottom: 1.1em;
   }
h3 {
    font-size: 130%;
    font-weight: bold;
    font-style: normal;
    padding: 0;
    margin-top: 1.3em;
    margin-bottom: 1.1em;
   }
h4 {
    font-size: 110%;
    font-weight: bold;
    font-style: normal;
    padding: 0;
    margin-top: 1.1em;
    margin-bottom: 1.1em;
   }
h5 {
    font-size: 100%;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin-top: 1em;
    margin-bottom: 1em;
   }
h6 {
    font-size: 100%;
    font-weight: normal;
    font-style: italic;
    padding: 0;
    margin-top: 1em;
    margin-bottom: 1em;
   }

/* divisions */
div {
    padding: 0;
    margin-top: 0em;
    margin-bottom: 0em;
   }

/* lists */
ul, ol {
    padding: 0 0 0 3em;
    margin-top: 1em;
    margin-bottom: 1em;
   }
ul ul, ol ol, ul ol, ol ul {
    margin-top: 1em;
    margin-bottom: 1em;
   }
li {
    padding: 0;
    margin-top: 1em;
    margin-bottom: 1em;
    text-align: left;
   }
li p {
    margin-top: 1em;
    margin-bottom: 1em;
   }
dl {
    padding: 0;
    margin-top: 1em;
    margin-bottom: 1em;
    margin-left: 1em;
   }
dl dl {
    margin-top: 0em;
    margin-bottom: 0em;
   }
dt {
    padding: 0;
    font-weight: bold;
    margin-top: .3em;
    margin-bottom: .3em;
   }
dd {
    padding: 0;
    margin-top: .3em;
    margin-left: 3em;
    margin-bottom: .3em;
   }
dl p {
    margin-top: .3em;
    margin-bottom: .3em;
   }

/* inline */
strong {
    font-weight: bold;
   }
em {
    font-style: italic;
   }
code {
    font-family: Courier New, Courier, monospace;
   }
ins {
    background-color: yellow;
    text-decoration: underline;
   }
del {
    text-decoration: line-through;
   }

/* anchors */
a[href] {
    color: blue;
    text-decoration: underline;
   }

/* end */
  </style>
</head>

<body>

<table border="1" style="width: 100%">
  <col />
  <col />
  <col />
  <col />
  <col />
  <col />
  <tbody>
    <tr>
      <td align="center" colspan="6"><a href="reference.html">Table Of
        Contents</a></td>
    </tr>
    <tr>
      <td><a href="#ClassSummary">Class Summary</a></td>
      <td><a href="#Inheritance">Inheritance</a></td>
      <td><a href="#ConstructorSummary">Constructor Summary</a></td>
      <td><a href="#ProcMethodsSummary">Proc/Methods Summary</a></td>
      <td><a href="#ConstructorDetail">Constructor Detail</a></td>
      <td><a href="#ProcMethodDetail">Proc/Method Detail</a></td>
    </tr>
    <tr>
      <td><a href="#Example">Example Application Transaction Class</a></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>

<p></p>

<table border="1" style="width: 100%">
  <col />
  <tbody>
    <tr>
      <td colspan="1"><strong><a id="ClassSummary"></a>Class:
        tdbo::Transaction</strong></td>
    </tr>
    <tr>
      <td>Database Transaction Interface that needs to be inherited by
        application-specific transaction classes (eg., SaveEmployee,
        DeletePurchaseItem etc.). This class cannot be directly
      instantiated.</td>
    </tr>
  </tbody>
</table>

<p></p>

<table border="1" style="width: 100%">
  <col />
  <tbody>
    <tr>
      <td colspan="1"><strong><a id="Inheritance"></a>Inherits: <a
        href="object.html">tdbo::Object</a></strong></td>
    </tr>
    <tr>
      <td>Methods: cget, clear, configure 

        <p>Variables: clsName, log</p>
      </td>
    </tr>
  </tbody>
</table>

<p></p>

<table border="1" style="width: 100%">
  <col />
  <col />
  <tbody>
    <tr>
      <td colspan="2"><strong><a id="ConstructorSummary"></a>Constructor
        Summary</strong></td>
    </tr>
    <tr>
      <td><a href="#constructor">constructor {db}</a></td>
      <td>Constructor.</td>
    </tr>
  </tbody>
</table>

<p></p>

<table border="1" style="width: 100%">
  <col />
  <tbody>
    <tr>
      <td colspan="2"><strong><a id="ProcMethodsSummary"></a>Proc/Methods
        Summary</strong></td>
    </tr>
    <tr>
      <td align="right"><code>public method</code> </td>
      <td><code><a href="#begin">begin {args}</a></code> 

        <p>Begin a database transaction.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>public method</code> </td>
      <td><code><a href="#commit">commit {args}</a></code> 

        <p>Commit currently active transaction.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>public method</code> </td>
      <td><code><a href="#rollback">rollback {args}</a></code> 

        <p>Rollback the currently active transaction.</p>
      </td>
    </tr>
    <tr>
      <td align="right"><code>public method</code> </td>
      <td><code><a href="#execute">execute {}</a></code> 

        <p>Execute the application transaction (e.g., SaveEmployee,
        DeletePurchaseItem).</p>
      </td>
    </tr>
  </tbody>
</table>

<p></p>

<table border="1" style="width: 100%">
  <col />
  <tbody>
    <tr>
      <td><strong><a id="ConstructorDetail"></a>Constructor Detail</strong></td>
    </tr>
    <tr>
      <td><dl>
          <dt><a id="constructor"></a><code><strong>constructor
          {db}</strong></code> </dt>
            <dd>Constructor. 
              <dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd>db - instance of a specific Database Connectivity
                    implementation such as SQLite.</dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
  </tbody>
</table>

<p></p>

<table border="1" style="width: 100%">
  <tbody>
    <tr>
      <td><strong><a id="ProcMethodDetail"></a>Proc/Method Detail</strong></td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="begin"></a>public method begin
          {args}</strong></code> </dt>
            <dd>Begin a database transaction.</dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>Specified by <a href="reference.html">Database
                          Connectivity Implementation</a> such as <a
                          href="sqlite.html">SQLite</a>. Typically they accept
                          parameters regarding type of locking to be done, save
                          point name etc.</dd>
                    </dl>
                  </dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="commit"></a>public method commit
          {args}</strong></code> </dt>
            <dd>End current transaction by committing changes to the
            database.</dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>Specified by <a href="reference.html">Database
                          Connectivity Implementation</a> such as <a
                          href="sqlite.html">SQLite</a>.</dd>
                    </dl>
                  </dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="rollback"></a>public method rollback
          {args}</strong></code> </dt>
            <dd>End current transaction without committing any changes at all
              or rollback upto a save point. In the case of rolling back to a
              specific save point, it may not really end the transaction. The
              exact behavior is specified by the <a
              href="reference.html">Database Connectivity Implementation</a>
              such as <a href="sqlite.html">SQLite</a>. </dd>
            <dd><dl>
                <dt><strong>Parameters:</strong></dt>
                  <dd><dl>
                      <dt><strong>args</strong></dt>
                        <dd>Typically save point name is accepted as an
                          optional parameter to support rolling back upto a
                          specific save point. Please refer to the
                          documentation of respective Database Connectivity
                          Class for further details.</dd>
                    </dl>
                  </dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td><dl>
          <dt><code><strong><a id="delete"></a>public method execute
          {}</strong></code> </dt>
            <dd>This method's purpose is to activate/initiate the execution of
              application transaction such as SaveEmployee, DeletePurchaseItem
              (classes that are derived from this class) etc.</dd>
            <dd><dl>
                <dt><strong>Returns:</strong></dt>
                  <dd>As specified by the application transaction class (such
                    as SaveEmployee, DeletePurchaseItem etc.).</dd>
              </dl>
            </dd>
        </dl>
      </td>
    </tr>
  </tbody>
</table>

<p></p>

<table border="1" style="width: 100%">
  <col />
  <tbody>
    <tr>
      <td><strong><a id="Example"></a>An Example Application Transaction
        Class</strong></td>
    </tr>
    <tr>
      <td><pre>itcl::class SaveEmployee {
    inherit tdbo::Transaction

    constructor {db args} {tdbo::Transaction::constructor $db} {
        configure {*}$args
    }

    destructor {}

    public {
        variable employee
        variable address
        variable op

        method execute {}
    }
}

proc saveemployee {db op employee address} {
    set trans [uplevel SaveEmployee #auto $db  -op $op -employee $employee -address $address]
    set result [uplevel $trans execute]
    itcl::delete object $trans
}

itcl::body SaveEmployee::execute {} {
    begin
        switch $op {
            add {
                if {[$address add] &lt;= 0} {
                    rollback
                    ${log}::error "Add Address failed. Address: [$address cget]"
                    return 0
                }

                $employee configure -address_id [$address cget -id]
                if {[$employee add] &lt;= 0} {
                    rollback
                    ${log}::error "Add Employee failed. Employee: [$employee cget]"
                    return 0
                }
            }
            update {
                if {[$address save] &lt;= 0} {
                    rollback
                    ${log}::error "Save Address failed. Address: [$address cget]"
                    return 0
                }
                if {[$employee save] &lt;= 0} {
                    rollback
                    ${log}::error "Save Employee failed. Employee: [$employee cget]"
                    return 0
                }
            }
        }

    commit
    return 1
}</pre>
      </td>
    </tr>
  </tbody>
</table>

<p></p>

<table border="1" style="width: 100%">
  <col />
  <col />
  <col />
  <col />
  <col />
  <col />
  <tbody>
    <tr>
      <td><a href="#ClassSummary">Class Summary</a></td>
      <td><a href="#Inheritance">Inheritance</a></td>
      <td><a href="#ConstructorSummary">Constructor Summary</a></td>
      <td><a href="#ProcMethodsSummary">Proc/Methods Summary</a></td>
      <td><a href="#ConstructorDetail">Constructor Detail</a></td>
      <td><a href="#ProcMethodDetail">Proc/Method Detail</a></td>
    </tr>
    <tr>
      <td><a href="#Example">Example Application Transaction Class</a></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td align="center" colspan="6"><a href="reference.html">Table Of
        Contents</a></td>
    </tr>
  </tbody>
</table>

<p></p>

<p></p>

<p style="font-size: 10pt">Copyright (c) 2013 by Nagarajan Chinnasamy
&lt;nagarajanchinnasamy@gmail.com&gt;. See <a href="license.html">License</a>
for information on usage and redistribution</p>
</body>
</html>
